import{_ as D,c as Q,w as h,r as l,o as c,a,b as u,d as m,t as y,e as x,F as P,f as k,g as p,h as A,i as I,j as U}from"./index-BOZw2FHI.js";const z=["零食广场","饼干","膨化薯片"],N=[{id:1,name:"哇哈哈",price:35.91,image:"./src/assets/goods/2.png",category:"零食广场"},{id:2,name:"饼干",price:35.91,image:"./src/assets/goods/3.png",category:"饼干"},{id:3,name:"膨化薯片",price:35.91,image:"./src/assets/goods/4.jpg",category:"膨化薯片"},{id:4,name:"哇哈哈",price:35.91,image:"./src/assets/goods/5.png",category:"零食广场"},{id:5,name:"哇哈哈",price:35.91,image:"./src/assets/goods/6.png",category:"零食广场"},{id:6,name:"哇哈哈",price:35.91,image:"./src/assets/goods/7.png",category:"膨化薯片"},{id:7,name:"哇哈哈",price:35.91,image:"./src/assets/goods/8.jpg",category:"零食广场"},{id:8,name:"哇哈哈",price:35.91,image:"./src/assets/goods/9.png",category:"零食广场"},{id:9,name:"哇哈哈",price:35.91,image:"./src/assets/goods/10.png",category:"零食广场"}],E=[],C={categories:z,products:N,cart:E},L=()=>new Promise(n=>{setTimeout(()=>{n(C.categories)},200)}),M=()=>new Promise(n=>{setTimeout(()=>{n(C.products)},200)}),G=()=>new Promise(n=>{setTimeout(()=>{n({cart:C.cart,totalPrice:C.cart.reduce((t,r)=>t+r.price*r.quantity,0)})},200)}),H=()=>new Promise(n=>{setTimeout(()=>{C.cart=[],n()},200)}),J={name:"ProductCard",props:{product:{type:Object,required:!0}}},K={class:"footer-controls"},R={key:0,class:"quantity-controls"},W={class:"quantity"},X={key:1};function Y(n,t,r,e,d,b){const v=l("van-button"),g=l("van-card");return c(),Q(g,{centered:"",title:r.product.name,thumb:r.product.image,price:r.product.price,currency:"¥",class:"product-card"},{footer:h(()=>[a("div",K,[r.product.quantity>0?(c(),u("div",R,[m(v,{icon:"minus",type:"success",size:"mini",round:"",onClick:t[0]||(t[0]=_=>n.$emit("decrease-quantity",r.product))}),a("span",W,y(r.product.quantity),1),m(v,{icon:"plus",type:"success",size:"mini",round:"",onClick:t[1]||(t[1]=_=>n.$emit("increase-quantity",r.product))})])):(c(),u("div",X,[m(v,{type:"success",size:"small",onClick:t[2]||(t[2]=_=>n.$emit("add-to-cart",r.product))},{default:h(()=>t[3]||(t[3]=[x(" 加入购物车 ")])),_:1})]))])]),_:1},8,["title","thumb","price"])}const Z=D(J,[["render",Y]]),$={name:"ProductSelectionPage",components:{ProductCard:Z},setup(){const n=p(""),t=p(0),r=p([]),e=p([]),d=p([]),b=p(!1),v=p(!1),g=A(()=>{if(!n.value)return r.value;const s=new Set(e.value.filter(i=>i.name.includes(n.value)).map(i=>i.category));return r.value.filter(i=>s.has(i))}),_=A(()=>{const s=g.value[t.value];return e.value.filter(i=>{const j=i.category===s,B=!n.value||i.name.includes(n.value);return j&&B})}),f=()=>{n.value="",t.value=0};I(g,s=>{s.length>0&&(t.value=0)});const w=async()=>{r.value=await L()},q=async()=>{e.value=await M()},S=async()=>{const s=await G();d.value=s.cart},T=s=>{s.quantity=1,d.value.push(s)},o=s=>{s.quantity+=1},V=s=>{s.quantity>0&&(s.quantity-=1,s.quantity===0&&(d.value=d.value.filter(i=>i.id!==s.id)))},O=async()=>{console.log("结算商品:",d.value),await H(),d.value=[]};U(()=>{w(),q(),S()});const F=A(()=>d.value.reduce((s,i)=>s+i.price*i.quantity,0));return{searchQuery:n,activeCategory:t,categories:r,products:e,cart:d,filteredCategories:g,filteredProducts:_,totalPrice:F,handleAddToCart:T,increaseQuantity:o,decreaseQuantity:V,handleCheckout:O,resetSearch:f,showCart:b,showOrderSummary:v}}},tt={class:"product-selection"},et={class:"search-bar"},ot={class:"content"},at={class:"category-nav"},nt={class:"product-list"},st={class:"products"},rt={class:"cart-bar"},ct={class:"cart-popup-header"},it={class:"cart-popup-content"},dt={key:0,class:"empty-cart"},lt={key:1},ut={class:"order-summary"},mt={class:"order-item-header"},yt=["src"],vt={class:"order-item-info"},gt={class:"order-item-name"},pt={class:"order-item-price"},_t={class:"order-item-footer"},ht={class:"order-total"};function Ct(n,t,r,e,d,b){const v=l("van-search"),g=l("van-sidebar-item"),_=l("van-sidebar"),f=l("ProductCard"),w=l("van-icon"),q=l("van-button"),S=l("van-popup"),T=l("van-dialog");return c(),u("div",tt,[a("div",et,[m(v,{modelValue:e.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=o=>e.searchQuery=o),placeholder:"搜索商品",onClear:e.resetSearch},null,8,["modelValue","onClear"])]),a("div",ot,[a("div",at,[m(_,{modelValue:e.activeCategory,"onUpdate:modelValue":t[1]||(t[1]=o=>e.activeCategory=o)},{default:h(()=>[(c(!0),u(P,null,k(e.filteredCategories,(o,V)=>(c(),Q(g,{key:V,title:o},null,8,["title"]))),128))]),_:1},8,["modelValue"])]),a("div",nt,[a("div",st,[(c(!0),u(P,null,k(e.filteredProducts,o=>(c(),Q(f,{key:o.id,product:o,onAddToCart:e.handleAddToCart,onIncreaseQuantity:e.increaseQuantity,onDecreaseQuantity:e.decreaseQuantity},null,8,["product","onAddToCart","onIncreaseQuantity","onDecreaseQuantity"]))),128))])])]),a("div",rt,[a("div",{class:"cart-info",onClick:t[2]||(t[2]=o=>e.showCart=!0)},[m(w,{name:"shopping-cart"}),a("span",null,"¥"+y(e.totalPrice.toFixed(2)),1)]),m(q,{type:"success",onClick:t[3]||(t[3]=o=>e.showOrderSummary=!0)},{default:h(()=>[x(" 去结算("+y(e.cart.length)+") ",1)]),_:1})]),m(S,{show:e.showCart,"onUpdate:show":t[5]||(t[5]=o=>e.showCart=o),position:"bottom",class:"cart-popup"},{default:h(()=>[a("div",ct,[t[8]||(t[8]=a("h3",null,"购物车",-1)),m(w,{name:"close",onClick:t[4]||(t[4]=o=>e.showCart=!1)})]),a("div",it,[e.cart.length===0?(c(),u("div",dt,t[9]||(t[9]=[a("p",null,"购物车为空",-1)]))):(c(),u("div",lt,[(c(!0),u(P,null,k(e.cart,o=>(c(),Q(f,{key:o.id,product:o,onAddToCart:e.handleAddToCart,onIncreaseQuantity:e.increaseQuantity,onDecreaseQuantity:e.decreaseQuantity},null,8,["product","onAddToCart","onIncreaseQuantity","onDecreaseQuantity"]))),128))]))])]),_:1},8,["show"]),m(T,{show:e.showOrderSummary,"onUpdate:show":t[6]||(t[6]=o=>e.showOrderSummary=o),title:"订单详情","show-cancel-button":"",onCancel:t[7]||(t[7]=o=>e.showOrderSummary=!1)},{default:h(()=>[a("div",ut,[(c(!0),u(P,null,k(e.cart,o=>(c(),u("div",{key:o.id,class:"order-item"},[a("div",mt,[a("img",{src:o.image,alt:"商品图片",class:"order-item-image"},null,8,yt),a("div",vt,[a("p",gt,y(o.name),1),a("p",pt,"¥"+y(o.price),1)])]),a("div",_t,[a("p",null,"数量: "+y(o.quantity),1),a("p",null,"小计: ¥"+y((o.price*o.quantity).toFixed(2)),1)])]))),128)),a("div",ht,[a("p",null,[t[10]||(t[10]=x("总价: ")),a("span",null,"¥"+y(e.totalPrice.toFixed(2)),1)])])])]),_:1},8,["show"])])}const wt=D($,[["render",Ct]]);export{wt as default};
